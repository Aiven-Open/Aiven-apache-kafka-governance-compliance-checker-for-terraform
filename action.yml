name: 'aiven_terraform_governance_compliance_check'
description: 'GitHub Action to check whether the plan generated by terraform plan complies with governance rules on aiven terraform provider resources.'
author: 'Aiven'

inputs:
  requester:
    description: 'The github username that created the pull request'
    required: true
  
  approvers:
    description: 'The github usernames (csv) that have approved the pull request'
    required: true

  plan:
    description: 'Plan generated by terraform plan -json'
    required: true

outputs:
  result:
    description: "the compliance result"
    value: ${{ steps.check.outputs.result }}

runs:
  using: "composite"
  steps:
  - name: Setup go
    uses: actions/setup-go@v5
    with:
      go-version-file: ${{ github.action_path }}/go.mod

  - name: Check Aiven Terraform Governance Compliance
    id: check
    run: |
        RESULT=$(
          ${{ github.action_path }}/build/checker -plan=${{ inputs.plan }} -requester=${{ inputs.requester }} -approvers=${{ inputs.approvers }}
        )
        echo "result=$RESULT" >> "$GITHUB_OUTPUT"
    shell: bash

branding:
  icon: 'shield'
  color: 'orange'